(function ($) { Drupal.behaviors.vr_weblight = { attach: function (context, settings) {$('input[name="submitted[phone]"]').on('keyup', function() {	if ($(this).val() == '+8') $(this).val('+7');    var val = $(this).val().length;    if (val !== 18) {    	if ($('.error-phone').length == 0) $(this).after('<div class="error-phone">Проверьте номер телефона</div>');        $(this).closest('form').find('input[type="submit"]').hide().prop('disabled', true);	} else {		$('.error-phone').remove();        $(this).closest('form').find('input[type="submit"]').show().prop('disabled', false);	}});$.fn.vr_filter('placeholder');if ($('.logged-in').length) {	if ($('.node-status-0').length) $('.node-property').addClass('hide-line');}if (!$('#slider-range').length) $('input[name="submitted[time]"]').after('<div id="slider-range"><div class="start">10:00</div><div class="end">21:00</div></div>');setTimeout(function() {	$("#slider-range").slider({	    range: true,	    min: 600,	    max: 1260,	    step: 15,	    values: [600, 1260],	    slide: function (e, ui) {	        var hours1 = Math.floor(ui.values[0] / 60);	        var minutes1 = ui.values[0] - (hours1 * 60);	        if (hours1.length == 1) hours1 = '0' + hours1;	        if (minutes1.length == 1) minutes1 = '0' + minutes1;	        if (minutes1 == 0) minutes1 = '00';	        $('#slider-range .start').html(hours1+':'+minutes1);	        var hours2 = Math.floor(ui.values[1] / 60);	        var minutes2 = ui.values[1] - (hours2 * 60);	        if (hours2.length == 1) hours2 = '0' + hours2;	        if (minutes2.length == 1) minutes2 = '0' + minutes2;	        if (minutes2 == 0) minutes2 = '00';	        	        $('#slider-range .end').html(hours2+':'+minutes2);	        $('input[name="submitted[time]"]').html(hours1+':'+minutes1+' - '+hours2+':'+minutes2);	    }	});}, 300);/*if (!$.browser['mobile']) {    WebFontConfig = {google: {families: ['PT+Sans:400,700:latin']}};    (function () {        var wf = document.createElement('script');        wf.src = 'https://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';        wf.type = 'text/javascript';        wf.async = 'true';        var s = document.getElementsByTagName('script')[0];        s.parentNode.insertBefore(wf, s);    })();} else {    WebFontConfig = {google: {families: ['Open+Sans:400,600,700:cyrillic-ext']}};    (function () {        var wf = document.createElement('script');        wf.src = 'https://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';        wf.type = 'text/javascript';        wf.async = 'true';        var s = document.getElementsByTagName('script')[0];        s.parentNode.insertBefore(wf, s);    })();}*/WebFontConfig = {google: {families: ['PT+Sans:400,700:cyrillic,cyrillic-ext']}};(function () {	var wf = document.createElement('script');	wf.src = 'https://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';	wf.type = 'text/javascript';	wf.async = 'true';	var s = document.getElementsByTagName('script')[0];	s.parentNode.insertBefore(wf, s);})();M.updateTextFields();function WebpIsSupported(callback) {    if(!window.createImageBitmap){        callback(false);        return;    }    var webpdata = 'data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoCAAEAAQAcJaQAA3AA/v3AgAA=';    fetch(webpdata).then(function(response){        return response.blob();    }).then(function(blob){        createImageBitmap(blob).then(function(){ callback(true); }, function(){ callback(false); });    });}WebpIsSupported(function(isSupported){    if (!isSupported) $('body').addClass('no-webp');});// При открытии "Заказать звонок"$('span.all-property').on('click', function() {	$('#back-call .webform-component--departament').hide();});$('.back-call').on('click', function() {	$('#back-call .webform-component--departament').show();});$(document).on('click', '.headerBottom__mobileLogo', function () {  if (!$('.overlay').length) {    $('body').append($('<div class="overlay" style="background: rgba(0,0,0,.8); z-index: 1; opacity: 0; top: 0px; width: 100%; height: 100%; position: fixed;" />'));    $('.overlay').fadeTo(400, 1);    $('header').addClass('vesco-block__open');    $('.vesco-block>.menu').slideToggle();  }});$(document).on('click', function (e) {  if (!$('.headerBottom__mobileLogo').is(e.target) & !$('a').is(e.target) & $('.overlay').length) {    $('.overlay').fadeOut();    setTimeout(function () {      $('.overlay').remove();      $('header').removeClass('vesco-block__open');    }, 400);    $('.vesco-block>.menu').slideToggle();  }});if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {	/*	$('.vesco-block').on('click', function() {		$('ul', this).stop().slideDown(400); setTimeout(function(){$('body').append('<div class="overflay" style="background: rgba(0,0,0,.8); z-index: 1; opacity: 1; top: 53px; width: 100%; height: 100%; position: fixed;"></div>');}, 200);		return;	});	$(document).on('touchstart', '.overflay', function() {		$('.vesco-block ul').slideUp(400); setTimeout(function(){$('body .overflay').remove();}, 400);		return;	});	*/	$('.fixed-action-btn').floatingActionButton({direction: 'top', hoverEnabled: false});	$('.fixed-action-btn').on('click', function() {		if ($(this).hasClass('active')) $(this).close();	});	$('footer .first-box').append($('#topbar .userlk'));} else {	$('.fixed-action-btn').floatingActionButton({direction: 'left'});	/*	$('.vesco-block').on('click', function() {		$('ul', this).stop().slideDown(400); setTimeout(function(){$('body').append('<div class="overflay" style="background: rgba(0,0,0,.8); z-index: 1; opacity: 1; top: 53px; width: 100%; height: 100%; position: fixed;"></div>');}, 200);		return;	});	$(document).on('click', '.overflay', function() {		$('.vesco-block ul').slideUp(400); setTimeout(function(){$('body .overflay').remove();}, 400);		return;	});	*/	/*	$('.vesco-block').mouseenter(function() {		// setTimeout(function() {			$('.vesco-block ul').slideDown(400); setTimeout(function(){$('body').append('<div class="overflay" style="background: rgba(0,0,0,.8); z-index: 1; opacity: 1; top: 53px; width: 100%; height: 100%; position: fixed;"></div>');}, 200);			return;		// }, 500);	}).mouseleave(function() {		$('ul', this).stop().slideUp(400); setTimeout(function(){$('body .overflay').remove();}, 400);		return;	});	*/}// ajaxvar ajaxSuccess = Drupal.ajax.prototype.success;Drupal.ajax.prototype.success = function(response, status) {	yaCounter15829528.reachGoal('order');	ajaxSuccess.apply(this, arguments);}// File$('input[type=file]').nicefileinput({ label : 'Выбрать файл...' });var loading = '<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>';$('.tooltipped').tooltip({delay: 50});var p = getParameterByName('price_href');if (p) $('html, body').animate({ scrollTop: $('.property-box-all .property-box-info[data-price="'+p+'"]').offset().top-50 }, 500);if ($('.flat-new-build .content-table .line-flat').height > 0) {	if (window.location.hash) {		var el = window.location.hash;		$('body').animate({scrollTop: $(el).offset().top-150}, 2000);		var t = $('.flat-new-build .content-table .line-flat'+el);		var flat = t.attr('data-nid');		var info = {			'type': 'flat-table-info',			'flat': flat		};		t.addClass('open');		var box = t.find('.flat-info');		box.html(loading);		$.ajax({			url: '/system/ajax-option',			type: 'post',			data: 'data=' + $.toJSON(info),			success: function(data) {				box.html(data);			}		});	}}if (!$('body').hasClass('logged-in')) {	$('#wrap-page #two-box').on('mouseover', '.banner:not(.hover)', function() {		if (!$(this).hasClass('hover')) {			$(this).addClass('hover');			var info = {				'type': 'banner-info',				'banner': $(this).data('nid'),				'action': '0',				'page': location.pathname+location.search			};			$.ajax({url: '/system/ajax-option', type: 'post', data: 'data=' + $.toJSON(info)});		}	});	$('#wrap-page #two-box').on('click', '.banner:not(.click)', function() {		if (!$(this).hasClass('click')) {			$(this).addClass('click');			var info = {				'type': 'banner-info',				'banner': $(this).data('nid'),				'action': '1',				'page': location.pathname+location.search			};			$.ajax({url: '/system/ajax-option', type: 'post', data: 'data=' + $.toJSON(info)});		}	});	// Загрузка страницы	if ($('#wrap-page #two-box .banner').length > 0) {		$('#wrap-page #two-box .banner').each(function() {			var target = $(this);			var targetPos = target.offset().top;			var winHeight = $(window).height();			var scrollToElem = targetPos-winHeight;			$(window).scroll(function() {				var winScrollTop = $(this).scrollTop();				if(winScrollTop > scrollToElem && !target.hasClass('scroll')) {					target.addClass('scroll');					var info = {'type': 'banner-info', 'banner': target.data('nid'), 'action': '2','page': location.pathname+location.search};					$.ajax({url: '/system/ajax-option', type: 'post', data: 'data=' + $.toJSON(info)});				}			});		});	}}function inWindow(s){  var scrollTop = $(window).scrollTop();  var windowHeight = $(window).height();  var currentEls = $(s);  var result = [];  currentEls.each(function(){    var el = $(this);    var offset = el.offset();    if(scrollTop <= offset.top && (el.height() + offset.top) < (scrollTop + windowHeight))      result.push(this);  });  return $(result);}if (!$('body').hasClass('page-filter') && !$('body').hasClass('page-filter2')) $('select:not(.hide)').formSelect();// Переключение валюты$(document).on('click', '.cy-btn div', function() {	if ($(this).data('cy')) var cy = $(this).data('cy');	else var cy = $(this).prop('class').substring(0, 3);	// Переключение валют	var cy_val = {'rub': '₽', 'usd': '$', 'eur': '€'};	cy_val = cy_val[cy];	$('.price-multi-box .content-box .num').each(function() {		$(this).html($(this).parent().attr('data-'+cy));		$(this).parent().find('.cy').html(cy_val);	});	// Переключение кнопок	$('.cy-btn .main').text(cy_val);	$('.cy-btn div').removeClass('active');	$('.cy-btn div.'+cy+'-btn').addClass('active');	// Переключение в фильтре	if ($('#search-filter .right-box input[name="type"]').length > 0 && $('#search-filter .right-box input[name="type"]').val() == 'complex') {		$('#search-filter .right-box .price .in-box .from input').attr('name', 'price_more_'+cy+'_from').attr('data-min', '').attr('data-max', '').attr('data-type-value', '');		$('#search-filter .right-box .price .in-box .to input').attr('name', 'price_more_'+cy+'_to').attr('data-min', '').attr('data-max', '').attr('data-type-value', '');	} else {		$('#search-filter .right-box .price .in-box .from input').attr('name', 'price_'+cy+'_from').attr('data-min', '').attr('data-max', '').attr('data-type-value', '');		$('#search-filter .right-box .price .in-box .to input').attr('name', 'price_'+cy+'_to').attr('data-min', '').attr('data-max', '').attr('data-type-value', '');	}	// Переключение валюты в фильтре	if (cy == 'eur') {		cy = 'rub';		$('#search-filter .right-box .price .cy-btn div.'+cy+'-btn').addClass('active');	}	if (cy == 'usd') $('.adminfilter .fbox .ib.boxes input[name="usd"]').val('1');	else $('.adminfilter .fbox .ib.boxes input[name="usd"]').val('');	// Валюта в фильтре	if ($('.termin-filter .line-field.price label.label-line').length > 0) {		var title = 'стоимость, млн';		if (cy == 'usd') title += ' (от 0.1)';		$('.termin-filter .line-field.price label.label-line').text(title);	}	$.cookie('cy', cy, { expires: 365, path: '/' });});$(document).on('change', 'input[name="conf"]', function() {	if ($(this).prop('checked') == false) $(this).parent().parent().find('input[type="submit"]').hide();	else $(this).parent().parent().find('input[type="submit"]').show();});var cy = 'rub';if (!$.cookie('cy') || $('body').data('currency')) {	if ($('body').data('currency')) cy = $('body').data('currency');} else cy = $.cookie('cy');// Переключение валютvar cy_val = {'rub': '₽', 'usd': '$', 'eur': '€'};cy_val = cy_val[cy];$('.price-multi-box .content-box .num').each(function() {	$(this).html($(this).parent().attr('data-'+cy));	$(this).parent().find('.cy').html(cy_val);});// Переключение кнопок$('.cy-btn .main').text(cy_val);$('.cy-btn div').removeClass('active');$('.cy-btn div.'+cy+'-btn').addClass('active');// переключение валюты в фильтреif (cy == 'eur') {	cy = 'rub';	$('#search-filter .right-box .price .cy-btn div.'+cy+'-btn').addClass('active');}if ($('#search-filter .right-box input[name="type"]').length > 0 && $('#search-filter .right-box input[name="type"]').val() == 'complex') {	$('#search-filter .right-box .price .in-box .from input').attr('name', 'price_more_'+cy+'_from');	$('#search-filter .right-box .price .in-box .to input').attr('name', 'price_more_'+cy+'_to');} else {	$('#search-filter .right-box .price .in-box .from input').attr('name', 'price_'+cy+'_from');	$('#search-filter .right-box .price .in-box .to input').attr('name', 'price_'+cy+'_to');}// Валюта в фильтреif ($('.termin-filter .line-field.price label.label-line').length > 0) {	var title = 'стоимость, млн';	if (cy == 'usd') title += ' (от 0.1)';	$('.termin-filter .line-field.price label.label-line').text(title);}if (cy == 'usd') $('.adminfilter .fbox .ib.boxes input[name="usd"]').val('1');else $('.adminfilter .fbox .ib.boxes input[name="usd"]').val('');$('.tabs-main-content .center-box .tabs-box .tabs-title').on('click', 'div', function() {	var name = $(this).attr('data-tabs');	// Вкладки	$('.tabs-main-content .center-box .tabs-box .tabs-title div').removeClass('active');	$('.tabs-main-content .center-box .tabs-box .tabs-title div[data-tabs="'+name+'"]').addClass('active');	// Контент	$('.tabs-main-content .center-box .tabs-box .tabs-content > div').removeClass('active');	$('.tabs-main-content .center-box .tabs-box .tabs-content > div[data-tabs="'+name+'"]').addClass('active');	// Заголовок	$('.tabs-main-content .left-box .box-title').removeClass('active');	$('.tabs-main-content .left-box .box-title[data-tabs="'+name+'"]').addClass('active');});// Скролл по быстрым ссылкам$('.node-property .top-btn-block .one-box ul li a[href*="#"], .node-property .center-box .main-photo a[href*="#"].plan-mini-link').on('click', function(e){	var name = $(this).attr('data-view');	// Вкладки	$('.tabs-main-content .center-box .tabs-box .tabs-title div').removeClass('active');	$('.tabs-main-content .center-box .tabs-box .tabs-title div[data-tabs="'+name+'"]').addClass('active');	// Контент	$('.tabs-main-content .center-box .tabs-box .tabs-content > div').removeClass('active');	$('.tabs-main-content .center-box .tabs-box .tabs-content > div[data-tabs="'+name+'"]').addClass('active');	// Заголовок	$('.tabs-main-content .left-box .box-title').removeClass('active');	$('.tabs-main-content .left-box .box-title[data-tabs="'+name+'"]').addClass('active');	var anchor = $(this);	var name = anchor.attr('href').replace(new RegExp("#",'gi'), '');	$('html, body').stop().animate({		scrollTop: $('a[name='+name+']').offset().top	}, 300);	e.preventDefault();	return false;});// Ближайшие поселки (выбор расстояния)$('.node-property .poselki-near .left-box .box-title.poselki .distance').on('click', 'span:not(.active)', function() {	$('.node-property .poselki-near .left-box .box-title.poselki .distance span').removeClass('active');	$(this).addClass('active');	var distance = $(this).attr('data-distance');	var property = $('#wrap-page #two-box .node-property').attr('data-type');	if (property !== 'village' && property !== 'complex') {		var nid = $('#wrap-page #two-box .node-property').attr('data-parent');	} else {		var nid = $('#wrap-page #two-box .node-property').attr('data-nid');	}	var info = {		'type': 'property-distance',		'nid': nid,		'property': property,		'distance': distance	};	var url = $('.node-property .poselki-near .left-box .box-title.poselki .count-property a').data('url');	$('.poselki-near .right-box .property-near-content').html('<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>');	$.ajax({		url: '/system/ajax-option',		type: 'post',		data: 'data=' + $.toJSON(info),		success: function(data) {			setTimeout(function () {				data = eval(data);				var count = data['count'];				$('.poselki-near .right-box .property-near-content').html('').hide().html(data['content']).fadeIn();				$('.node-property .poselki-near .left-box .box-title.poselki .count-property a').text('Полный список ('+count+')').attr('href', url+distance);			}, 500);		}	});});$('.main-content .right-box .box-buy-property .tabs-box .tabs-title').on('click', 'div:not(.active)', function() {	// id	var active = $(this).attr('data-type-buy-property');	// для вкладок	$('.main-content .right-box .box-buy-property .tabs-box .tabs-title div').removeClass('active');	$('.main-content .right-box .box-buy-property .tabs-box .tabs-title div[data-type-buy-property="'+active+'"]').addClass('active');	// для контента	$('.main-content .right-box .box-buy-property .tabs-box .tabs-content div').removeClass('active');	$('.main-content .right-box .box-buy-property .tabs-box .tabs-content div[data-type-buy-property="'+active+'"]').addClass('active');	// куки});$('.box-recommend .tabs-box .tabs-title').on('click', 'div', function() {	// id	var active = $(this).attr('data-type-buy-property');	// для вкладок	$('.box-recommend .tabs-box .tabs-title div').removeClass('active');	$('.box-recommend .tabs-box .tabs-title div[data-type-buy-property="'+active+'"]').addClass('active');	// для контента	$('.box-recommend .tabs-box .tabs-content div').removeClass('active');	$('.box-recommend .tabs-box .tabs-content div[data-type-buy-property="'+active+'"]').addClass('active');});// Вкладки на главной страницеvar type_link = {	'cottage': '/zagorod/cottages',	'flat': '/gorod/flats',	'townhouse': '/zagorod/townhouses',	'plot': '/zagorod/plot',	'poselki': '/zagorod/poselki',	'complex': '/gorod/zhk',	'gorod': '/gorod',	'zagorod': '/zagorod',	'commercial': '/commercial'};$('#wrap-page #two-box .property-front .header ul li').on('click', function() {	var type_property = $(this).attr('data-type-property');	var type_block = $(this).parent().parent().parent().attr('data-type');	var block = $('#wrap-page #two-box .property-front[data-type="'+type_block+'"]');	block.find('.content > div').addClass('hide');	block.find('.content [data-type-property="'+type_property+'"]').removeClass('hide');	block.find('.header .type-property li').removeClass('active');	block.find('.header .type-property li[data-type-property="'+type_property+'"]').addClass('active');	block.find('.header .link').attr('href', type_link[type_property]);});// Раскрытие текста$('#wrap-page #two-box #block-block-2 .button, #wrap-page #two-box #inform-block-description section .button').on('click', function() {	if ($(this).hasClass('icon-arrow-down')) {		$(this).removeClass('icon-arrow-down').addClass('icon-arrow-up');		$(this).parent().find('.block-content').addClass('open');	} else {		$(this).removeClass('icon-arrow-up').addClass('icon-arrow-down');		$(this).parent().find('.block-content').removeClass('open');	}});// Вкладки$('#wrap-page #two-box .blog-last-post .content .two-box .line-title').on('click', function() {	var number = $(this).attr('data-number');	var height = $(this).height()+30;	if (height == '50') {		$(this).addClass('small');	} else if (height > '70') {		$(this).addClass('big');	}	$('#wrap-page #two-box .blog-last-post .content .two-box .line-title').removeClass('active');	$(this).addClass('active');	$('#wrap-page #two-box .blog-last-post .content .one-box .box-post-line').removeClass('active');	$('#wrap-page #two-box .blog-last-post .content .one-box .box-post-line[data-number="'+number+'"]').addClass('active');});// При наведении на строку контекстного поиска$('#search-context input[type=text]').on('focusin', function() {	$('body').addClass('overflow-search');	$('#topbar .mobile_m').addClass('overflow-search');	$('#search-context').addClass('full');});$(document).on('click', 'body.overflow-search', function(event) {	if ($(event.target).closest('#search-context input[type=text]').length == 0 && $(event.target).attr('class') !== 'icon-search' && $(event.target).parent().attr('class') !== 'line' && $(event.target).attr('class') !== 'find') {		$('body').removeClass('overflow-search');		$('#topbar .mobile_m').removeClass('overflow-search');		$('#search-context').removeClass('full');	}});// Карта над фото$('.node-property .center-box .main-photo .map-mini').on('click', function() {	var width = $('.node-property .center-box .main-photo .map-mini-content').attr('data-width');	var height = $('.node-property .center-box .main-photo .map-mini-content').attr('data-height');	$('.node-property .center-box .main-photo .map-mini-content').css('height', height).css('width', width).addClass('open');	if ($('.node-property .center-box .main-photo .map-mini-photo').length == 0) {		var img = $('.node-property .center-box .main-photo img').attr('src');		$('.node-property .center-box .main-photo').append('<div class="map-mini-photo open"><img src="'+img+'" /></div>');	} else {		$('.node-property .main-photo .map-mini-photo').addClass('open');	}});$('.node-property .center-box .main-photo').on('click', '.map-mini-photo', function() {	$('.node-property .center-box .main-photo .map-mini-photo').removeClass('open');	$('.node-property .center-box .main-photo .map-mini-content').removeClass('open').css('height', '0').css('width', '0');});// В избранном$('a.flag').on('click', function() {	var info = { 'type': 'count-fav' };	$.ajax({		url: '/system/ajax-option',		type: 'post',		data: 'data=' + $.toJSON(info), 		success: function (count) { 			$('#informer .fav .count').text(eval(count)); 		} 	});});// Переключение изображенийif (!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {	$('.node-property .center-box .main-photo').on('click', '.front-photo', function(event) {		var t = $(this).find('img');		var x = event.offsetX;		var w = t.width()/2;		var p = w-x;		var max = parseInt(t.attr('data-max'));		if (max > 1) {			var index = parseInt(t.attr('data-index'));			if (p < '0') index = index+1;			else index = index-1;			if (index == '0') index = max;			else if (index > max) index = '1';			t.attr('data-index', index);			var src = $('.more-images li[data-num="'+index+'"]').attr('data-front');			t.attr('src', src);			$('.node-property .center-box .main-photo').addClass('load').append('<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>');			// Проверяем статус загрузки			t.bind('load', function(){				$('.node-property .center-box .main-photo').removeClass('load');				$('.node-property .center-box .main-photo .spinner').remove();			});		}	});}// Загрузка 3d-тура, если он есть$('.tabs-main-content .center-box .tabs-box .tabs-title div[data-tabs="tour"]').on('click', function() {	var content = $('.tabs-main-content .center-box .tabs-box .tabs-content div[data-tabs="tour"]');	if (content.attr('data-load') == 'no') {		var info = {			'type': '3d-tour',			'nid': $('.node-property').attr('data-nid')		};		$.ajax({			url: '/system/ajax-option',			type: 'post',			data: 'data=' + $.toJSON(info),	 		success: function (data) {	 			content.html(data).attr('data-load', 'yes');	 		}	 	});	}});function isNumber(n) {	return !isNaN(parseFloat(n)) && isFinite(n);}// Получение короткой ссылки$('#informer .short-url > span').on('click', function() {	$('#informer').toggleClass('open');});// Получить ссылку (submit)$('#informer .short-url').on('click', '.submit', function() {	var	info = {		'type': 'short-url',		'uid': $('#informer .short-url .params').attr('data-uid'),		'url': window.location.pathname,		'params': window.location.search.split('&'),		'broker': $('#informer .short-url #broker').prop('checked')	};	$.ajax({		url: '/system/ajax-option',		type: 'post',		data: 'data=' + $.toJSON(info),	 	success: function (data) {	 		$('#informer .short-url .link').attr('type', 'text').val('https://vesco-realty.ru/l/'+data);	 		setTimeout(function () {		 		$('#informer .short-url .link').focus();		 		$('#informer .short-url .link').select();		 	}, 100);	 	}	});});// facebook(function() {  var _fbq = window._fbq || (window._fbq = []);  if (!_fbq.loaded) {    var fbds = document.createElement('script');    fbds.async = true;    fbds.src = '//vesco-realty.ru/sites/all/themes/vrealty_weblight/js/fb.js';    var s = document.getElementsByTagName('script')[0];    s.parentNode.insertBefore(fbds, s);    _fbq.loaded = true;  }  _fbq.push(['addPixelId', "1376329062653064"]);})();window._fbq = window._fbq || [];window._fbq.push(["track", "PixelInitialized", {}]);$.cachedScript = function( url, options ) {   options = $.extend( options || {}, {    dataType: "script",    cache: true,    url: url  });  return jQuery.ajax(options);};// Карта$('.sidebar-first #two-box').on('click', '.property-box-info .photo-property .map:not(.active)', function() {	var box = $(this).parent().parent().find('.map-mini-content');	var zoom = 10;	var type = $(this).closest('.property-box-info').attr('data-type');	if (type == 'apartment' || type == 'complex') zoom = 13;	if (box.find('ymaps').length > 0) {		box.css('height', '250px');	} else {		var nid = box.attr('data-nid');		var info = {			'type': 'geoinfo',			'nid': nid		};		box.addClass('open');		$.ajax({			url: '/system/ajax-option',			type: 'post',			data: 'data=' + $.toJSON(info),	 		success: function (data) {	 			$.cachedScript('//api-maps.yandex.ru/2.1/?lang=ru_RU').done(function() {		 			ymaps.ready(function () {			 			var map = new ymaps.Map('map-mini-content-'+nid, {center: [data['lat'], data['lon']], zoom: zoom});				 		map.controls.remove('fullscreenControl').remove('searchControl').remove('geolocationControl').remove('routeEditor');				 		var placemark = new ymaps.Placemark([data['lat'], data['lon']], {preset: "twirl#yellowStretchyIcon"});				 		map.geoObjects.add(placemark);				 	});				});	 		}	 	});	}	$(this).addClass('active').text('Скрыть карту');});$('.sidebar-first #two-box').on('click', '.property-box-info .photo-property .map.active', function() {	var box = $(this).parent().parent().find('.map-mini-content');	box.css('height', 0);	$(this).removeClass('active').text('Показать на карте');});if ($('.node-property .center-box .more-images').length > 0) {	$('.node-property .center-box .more-images').lightGallery({		fullscreen: false,		autoplayControls: false,		download: true,		actualSize: false,		hash: false,		getCaptionFromTitleOrAlt: false,		share: false,		showThumbByDefault: true,		preload: 2	});	if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {		$('.node-property .center-box .main-photo').click(function() {			$('.node-property .center-box .more-images li:nth-child(1)').trigger('click');		});	}}if ($('.tabs-main-content div[data-tabs="plan"]').length > 0) {	$('.tabs-main-content div[data-tabs="plan"]').lightGallery({		fullscreen: false,		autoplayControls: false,		download: false,		actualSize: false,		hash: false,		getCaptionFromTitleOrAlt: false,		share: false,		showThumbByDefault: false,		preload: 2	});}if ($('.tabs-main-content div[data-tabs="plan-floor"]').length > 0) {	$('.tabs-main-content div[data-tabs="plan-floor"]').lightGallery({		fullscreen: false,		autoplayControls: false,		download: false,		actualSize: false,		hash: false,		getCaptionFromTitleOrAlt: false,		share: false,		showThumbByDefault: false,		preload: 2	});}if ($('.node-property .main-content .right-box .combo-box.plans').length > 0) {	$('.node-property .main-content .right-box .combo-box.plans .box-content').lightGallery({		fullscreen: false,		autoplayControls: false,		download: false,		actualSize: false,		hash: false,		getCaptionFromTitleOrAlt: false,		share: false,		showThumbByDefault: false,		preload: 2	});}// fav$('#two-box').on('click', '.property-box-all .more-links .fav, .node-property .two-box ul.more-links li.fav, .property-box-info .right-box-property .more-links li.fav, .node-property .box-9.center-box .main-photo .fav, .line-flat .fav', function() {	var t = $(this);	var t_replace = true;	if ($(this).closest('.listing-property').length > 0) t_replace = false;	// статус	var status = t.attr('data-status');	// id записи	var nid = t.attr('data-nid');	var type = t.attr('data-type');	var info = {		'type': 'save-property',		'nid': nid,		'fltype': status	};	$.ajax({		url: '/system/termin',		type: 'post',		data: 'data=' + $.toJSON(info),		success: function(data) {			var title = '';			if (data && status == 'no') {				t.attr('data-status', 'yes').addClass('active').find('.title').text('Убрать из избранного');				title = $('<span class="arert-fav">Объект успешно добавлен в избранное!</span>');				if (type == 'page' && t_replace) t.text('Из избранного');			} else if (data && status == 'yes') {				t.attr('data-status', 'no').removeClass('active').find('.title').text('Добавить в избранное');				title = $('<span class="arert-fav">Объект успешно удален из избранного!</span>');				if ($('body.logged-in.page-property-fav').length > 0) {					t.closest('.property-box-info').remove();				}				if (type == 'page' && t_replace) t.text('В избранное');			} else {				title = 'Извините, произошла ошибка с добавлением объекта в избранное, попробуйте ещё раз!';			}			M.toast({'html': title, 'outDuration': 3000});			var info = { 'type': 'count-fav' };			$.ajax({				url: '/system/ajax-option',				type: 'post',				data: 'data=' + $.toJSON(info),		 		success: function (count) {		 			$('#informer .fav .count').text(eval(count));		 		}		 	});		}	});});// Очистить список избранного$('.box-termin-informer h1 span.clear-fav').on('click', function() {	$('.property-box-all .property-box-info').each(function() {		var t = $(this);		var nid = t.find('.map-mini-content').data('nid');		var info = {			'type': 'save-property',			'nid': nid,			'fltype': 'yes'		};		$.ajax({			url: '/system/termin',			type: 'post',			data: 'data=' + $.toJSON(info)		});	});	$('.sort-filter-termin').remove();	$('.box-termin-informer .sum .num, #informer .fav span.count').text('0');	$('.box-termin-informer .sum .show').text('');	$('.property-box-all').html('Результат выборки оказался пустым, попробуйте изменить условия поиска');});// Глобальная очистка избранного$('#informer .fav.delete').on('click', function() {	var info = {		'type': 'favdelete',		'uid': $(this).data('uid')	}	$.ajax({		url: '/system/ajax-option',		type: 'post',		data: 'data=' + $.toJSON(info),		success: function() {			M.toast({html: 'Избранное очищено'});			$('#informer .fav .count').text('0');			$('.page-property-fav .property-box-all').html('Результат выборки оказался пустым, попробуйте изменить условия поиска');		}	});});$('.node-property .top-btn-block .one-box ul li a[data-view="plan"]').on('click', function() {	$('.tabs-main-content .center-box .tabs-box .tabs-content div[data-tabs="plan"] a').click();});function getParameterByName(name, url) {    if (!url) url = window.location.href;    name = name.replace(/[\[\]]/g, "\\$&");    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),		results = regex.exec(url);    if (!results) return null;    if (!results[2]) return '';    return decodeURIComponent(results[2].replace(/\+/g, " "));}/*$('#two-box').on('click', '.flat-new-build .content-table .line-flat > span:not(.flat-info):not(.fav):not(.index)', function() {	var t = $(this).parent('.line-flat');	if (t.hasClass('open')) {		t.removeClass('open');	} else {		$('.flat-new-build .content-box-table .content-table').addClass('open');		var flat = t.attr('data-nid');		var info = {			'type': 'flat-table-info',			'flat': flat		};		t.addClass('open');		var box = t.find('.flat-info');		box.html(loading);		$.ajax({			url: '/system/ajax-option',			type: 'post',			data: 'data=' + $.toJSON(info),			success: function(data) {				box.html(data);			}		});	}});*/function getSorted(selector, attrName, type = 'asc') {    return $($(selector).toArray().sort(function(a, b) {        var aVal = parseInt(a.getAttribute(attrName)),            bVal = parseInt(b.getAttribute(attrName));        if (type == 'asc') return aVal - bVal;        else if (type == 'desc') return bVal - aVal;    }));}$('.flat-new-build:not(.property-list-compact) .header-table').on('click', '.tabs-sort:not(.no-active)', function() {	// закрываем все	$('.flat-new-build .content-table .line-flat.open').each(function() { $(this).removeClass('open'); });	// сортировка	var type = $(this).data('type');	var sort = {'asc': 'desc', 'desc': 'asc'};	if ($(this).hasClass('active')) {		var sort = sort[$(this).attr('data-sort')];		$(this).attr('data-sort', sort);		$('.flat-new-build .content-table').html(getSorted('.line-flat', 'data-'+type, sort));	} else {		$('.flat-new-build .header-table .tabs-sort').removeClass('active');		$(this).attr('data-sort', 'asc').addClass('active');		$('.flat-new-build .content-table').html(getSorted('.line-flat', 'data-'+type, 'asc'));	}});// add id$('.flat-new-build .content-table').on('click', '.line-flat .flat-info .box-info .line-info-links span.btn-view', function() {	$('.webform-component--nid input').val(window.location.href+'#flat-'+$(this).attr('data-id'));});$('.node-property .flat-new-build[data-load="true"]').mouseenter(function() {	var nids = {};	$('.flat-new-build .content-table .line-flat .plan-load').each(function() { nids[$(this).parent().data('nid')] = $(this).parent().data('nid'); });	var info = {		'type': 'new-image-load',		'nids': nids	}	$.ajax({		url: '/system/ajax-option',		type: 'post',		data: 'data=' + $.toJSON(info),		success: function(data) {			$.each(data, function(index, value) { $('.line-flat[data-nid="'+index+'"] .plan-load').before(value).remove(); });		}	});});if ($('#maps-near').length > 0) {	var maps = $('#maps-near');	// Иконка загрузки	maps.html(loading);	// Количество	var count = 0;	// Получение данных	var parent = $('.node-property').data('parent');	if ($('.node-property').data('type') == 'complex') parent = $('.node-property').data('nid');	var info = {		'type': 'maps-near',		'nid': parent,		'property': $('.node-property').data('nid'),		'object': $('.node-property').data('type')	}	$.ajax({		url: '/system/ajax-option',		type: 'post',		data: 'data=' + $.toJSON(info),		success: function (data) {			ymaps.ready(function () {				maps.html('');				var zoom = 15;				var center = data['center'];				var map = new ymaps.Map('maps-near', {center: center, zoom: zoom}, {autoFitToViewport: 'always'});				map.controls.remove('fullscreenControl').remove('searchControl').remove('geolocationControl').remove('routeEditor');				// Выводим объекты				objectManager = new ymaps.ObjectManager({clusterize: true, gridSize: 64, preset: 'islands#darkBlueClusterIcons'});				map.geoObjects.add(objectManager);				objectManager.add(data['data']);				objectManager.objects.options.set('balloonPanelMaxMapArea', 'Infinity');				objectManager.objects.options.set('balloonMinHeight', '300');				objectManager.objects.options.set('balloonMaxHeight', '450');				// Действие при клике				objectManager.objects.events.add(['click'], onObjectEvent);				// Количество				objectManager.objects.each(function(val) { count += 1; });				// Функция для действия по клику				function onObjectEvent(e) {					maps.css('height', '600px');				    var	id = e.get('objectId');				    var obj = objectManager.objects.getById(id);				    var nid = obj.properties.balloonContent;				    var newballoon = loading;				    if (isNumber(nid)) {			            obj.properties.balloonContent = newballoon;						var info = {						   'type': 'ballooncontent',						   'nid': nid						}						$.ajax({							url: '/system/ajax-option',							type: 'post',							data: 'data=' + $.toJSON(info),							success: function(data) {								obj.properties.balloonContent = data;								objectManager.objects.balloon.open(id);							}						});			        }				}			});		}	});}// Block broker open$('#modal-contact-block-close').unbind('click').on('click', function() {	$(this).hide(200);	$('#modal-contact-block').addClass('opencheck');	if (!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {		$('#modal-contact-block').animate({bottom: '23px'});	} else $('#modal-contact-block').animate({bottom: '0'});});$('#modal-contact-block .close').unbind('click').on('click', function() {	if (!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {		$('#modal-contact-block').animate({bottom: '-700px'});	} else $('#modal-contact-block').animate({bottom: '-1000px'});	$('#modal-contact-block-close').show(200);});$('#modal-contact-block').on('click focus', function() {	$(this).addClass('opencheck');	$.cookie('contact', 'hide', { expires: 365, path: '/' });});!function(){	var t=document.createElement("script");	t.type="text/javascript",	t.async=!0,	t.src="https://vk.com/js/api/openapi.js?159",	t.onload=function(){		VK.Retargeting.Init("VK-RTRG-259361-5j2v0"),		VK.Retargeting.Hit(),		VK.Retargeting.Init("VK-RTRG-259363-3sJsn"),		VK.Retargeting.Hit(),		VK.Retargeting.Init("VK-RTRG-259366-exuHT"),		VK.Retargeting.Hit()	},	document.head.appendChild(t)}();}}})(jQuery);